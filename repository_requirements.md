# 系統的文献検索式開発プロジェクト リポジトリ構成要件

## 1. 背景と目的

### 1.1 背景
- システマティックレビューにおける検索式開発の自動化・効率化が必要
- 検索式の品質保証プロセスの標準化が求められている
- 複数データベースへの検索式変換の正確性確保が重要

### 1.2 目的
- RQと組入基準に基づく検索式の自動生成
- MeSH用語とフリーワードの最適な組み合わせの提案
- 検索式の妥当性確認プロセスの自動化
- 複数データベース間の検索式変換の正確性向上

## 2. ディレクトリ構成要件

### 2.1 基本構造
```
search-formula-developer/
├── scripts/                    # 検索式開発用スクリプト
│   ├── initialize/            # 初期設定
│   │   ├── rq_analyzer.py    # RQ解析
│   │   └── criteria_parser.py # 組入基準解析
│   ├── search/               # 検索式構築・実行
│   │   ├── block_generator/  # 検索ブロック生成
│   │   ├── mesh_analyzer/    # MeSH用語分析
│   │   ├── term_validator/   # 用語妥当性確認
│   │   └── query_executor/   # 検索実行
│   ├── validation/           # 検証
│   │   ├── seed_analyzer/    # シード研究分析
│   │   ├── term_checker/     # 個別用語確認
│   │   └── result_validator/ # 検索結果検証
│   ├── conversion/           # 検索式変換
│   │   ├── central/         # CENTRAL変換
│   │   └── embase/          # Embase変換
│   └── utils/               # 共通ユーティリティ
├── templates/                 # 検索式テンプレート
│   ├── blocks/              # 検索ブロック
│   └── database/           # データベース別
├── docs/                     # ドキュメント
│   ├── pico/               # PICO定義
│   ├── criteria/           # 組入基準
│   └── analysis/           # 分析結果
└── logs/                     # ログファイル
    ├── search/             # 検索実行ログ
    ├── validation/         # 検証ログ
    └── conversion/         # 変換ログ
```

### 2.2 必須ファイル
- `README.md`: プロジェクト概要、使用方法
- `CONTRIBUTING.md`: 開発参加ガイド
- `LICENSE`: ライセンス情報
- `requirements.txt`: 依存パッケージ

## 3. 機能要件

### 3.0 Human-in-the-Loop要件
- 各フェーズでの人間の介入ポイント
  - 提案内容の確認と修正
  - 結果の妥当性評価
  - 次フェーズへの移行判断
- 対話的な検証プロセス
  - 提案された変更の承認
  - 代替案の提示と選択
  - エラー時の対処方針決定
- 進捗状況の可視化
  - 各フェーズの完了状態
  - 未解決の課題
  - 人間の判断待ち項目

### 3.1 初期設定フェーズ
- RQの解析と構造化
  - PICO要素の抽出
  - キーコンセプトの特定
- 組入基準の解析
  - 必須要素の抽出
  - 除外基準の整理

### 3.2 検索ブロック生成フェーズ
- コンセプトごとの検索ブロック提案
  - 提案内容の人間による確認
  - ブロック構造の手動調整オプション
- MeSH用語の自動検索と分析
  - シード研究からのMeSH抽出
  - 関連MeSH用語の提案
  - 提案された用語の妥当性確認
- フリーワードの自動生成
  - 同義語・類義語の提案
  - 表記ゆれの考慮
  - 用語の追加・削除の手動制御

### 3.3 検索式構築フェーズ
- 検索ブロックの組み合わせ
  - 組み合わせ方法の選択肢提示
  - 優先順位の手動調整
- 構文の最適化
  - 最適化提案の確認
  - 手動での構文調整
- 検索制限の適用
  - 制限オプションの選択
  - カスタム制限の追加

### 3.4 妥当性確認フェーズ
- 個別用語の有効性確認
  - ヒット件数の分析
  - 不適切な除外の確認
  - 問題のある用語の手動修正
- シード研究の包含確認
  - 各研究の検索可能性確認
  - 漏れの原因分析
  - 追加対策の検討と承認
- 最終検索結果の評価
  - 総件数の妥当性確認
  - ノイズ評価
  - 最終的な承認判断

### 3.5 検索式変換フェーズ
- CENTRAL用変換
  - 構文規則の適用
  - フィールドコードの変換
  - 変換結果の確認と調整
- Embase(Dialog)用変換
  - Emtree用語への変換
  - Dialog構文への変換
  - 変換精度の人間による確認

### 3.6 進捗管理
- フェーズごとの承認状態管理
  - 承認済み項目の記録
  - 保留項目の追跡
  - 差し戻し項目の管理
- 変更履歴の追跡
  - 人間による修正の記録
  - 判断根拠の文書化
  - フィードバックの蓄積
- レポート生成
  - 各フェーズの進捗状況
  - 人間の介入履歴
  - 未解決課題の一覧

## 4. コード規約

### 4.1 開発規約
- PEP 8準拠
- 型ヒントの使用
- 関数・クラスの文書化

### 4.2 エラー処理
- 例外の適切な捕捉
- エラーメッセージの標準化
- リカバリー処理の実装

## 5. 品質管理要件

### 5.1 検証プロセス
- ユニットテストの実装
- 統合テストの実施
- 既知の検索式での検証

### 5.2 ログ管理
- 検索実行の記録
- 変換プロセスの追跡
- エラー情報の保存

## 6. 拡張性要件

### 6.1 新規データベース対応
- 検索構文の追加
- フィールドコードの定義
- 用語マッピングの実装

### 6.2 カスタマイズ機能
- 検索ブロックテンプレートの追加
- 変換ルールの拡張
- 出力形式の設定

### 6.3 API連携
- PubMed API設定
- その他データベースAPI対応
- 認証情報の管理
